<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Study Features — SynapseStudy</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <nav class="topbar">
      <div class="brand">SynapseStudy</div>
      <a class="back-link" href="./index.html">← Back</a>
    </nav>
    <main class="content">
      <section id="featuresSection" class="hidden" aria-hidden="true">
        <h1>Study Features</h1>
        <div class="features-form" id="featuresForm">
          <div class="feature">
            <label for="feature1">
              <input type="checkbox" id="feature1" />
              Recognize Patterns
            </label>
          </div>

          <div class="feature">
            <label for="feature2">
              <input type="checkbox" id="feature2" />
              Step by step solving
            </label>
          </div>

          <div class="feature">
            <label for="feature3">
              <input type="checkbox" id="feature3" />
              Flash cards
            </label>
          </div>

          <div class="feature">
            <label for="feature4">
              <input type="checkbox" id="feature4" />
              Practice prompts or problems
            </label>
          </div>
      </div>
      </section>

      <!-- Search bar at the bottom; triggers the features to pop up above -->
      <form id="searchForm" class="search-bar" role="search" aria-label="Study search">
        <input
          id="searchInput"
          class="search-input"
          type="search"
          placeholder="Search a topic to enable features..."
          autocomplete="off"
          aria-label="Search topic"
          required
        />
        <button class="search-btn" type="submit">Search</button>
      </form>
    </main>

    <script>
      (function () {
        // Toggle features visibility based on search
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const featuresSection = document.getElementById('featuresSection');

        function revealFeatures() {
          if (!featuresSection) return;
          featuresSection.classList.remove('hidden');
          featuresSection.setAttribute('aria-hidden', 'false');
        }

        // Restore reveal state if user searched before
        const priorQuery = localStorage.getItem('study_search_query');
        if (priorQuery && searchInput instanceof HTMLInputElement) {
          searchInput.value = priorQuery;
          revealFeatures();
        }

        if (searchForm && searchInput instanceof HTMLInputElement) {
          searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const q = searchInput.value.trim();
            if (!q) return;
            localStorage.setItem('study_search_query', q);
            revealFeatures();
          });
        }

        const features = ['feature1', 'feature2', 'feature3', 'feature4'];

        // Restore checkbox state and persist changes
        features.forEach((id) => {
          const boxEl = document.getElementById(id);
          if (!(boxEl instanceof HTMLInputElement)) return;
          const savedChecked = localStorage.getItem(id);
          if (savedChecked !== null) boxEl.checked = savedChecked === '1';
          boxEl.addEventListener('change', () => {
            localStorage.setItem(id, boxEl.checked ? '1' : '0');
          });
        });

        // No save button; state persists automatically via localStorage
      })();
    </script>
  </body>
  </html>
